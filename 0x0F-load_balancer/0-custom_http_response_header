#!/bin/env bash

# Install Nginx if it is not already installed
sudo apt-get update -y

sudo apt-get install -y nginx

sudo ufw allow 'Nginx HTTP'

sudo chown -R $USER:$USER /var/www

sudo chmod -R 755 /var/www

echo "Hello World!" | sudo tee /var/www/html/index.html

HEADER_NAME="X-Served-By"

# Get the hostname of the server
HOSTNAME=$(hostname)

CONFIG_FILE="/etc/nginx/conf.d/new.conf"

sudo cp /etc/nginx/sites-enabled/default $CONFIG_FILE

sudo tee $CONFIG_FILE > /dev/null <<EOL
server {
    listen 80;
    listen [::]:80;

    server_name $HOSTNAME;

    location / {
        add_header X-Served-By $HOSTNAME;
        try_files \$uri \$uri/ =404;
    }
}
EOL

sudo systemctl reload nginx
